<% content_for :title, "Sell.io - Buy & Sell Anything" %>

<% if notice %>
  <div class="alert alert-success"><%= notice %></div>
<% end %>

<div class="homepage">
  <!-- Hero Section with Search (only show on homepage) -->
  <% unless params[:category_id].present? || params[:search].present? %>
  <section class="hero-section">
    <div class="hero-content">
      <h1 class="hero-title">Buy & Sell Anything</h1>
      <p class="hero-subtitle">Free classified ads in your area</p>
      
      <% unless user_signed_in? %>
        <div class="auth-buttons-hero">
          <%= link_to "Login", new_user_session_path, class: "btn-hero btn-login" %>
          <%= link_to "Sign Up", new_user_registration_path, class: "btn-hero btn-signup-hero" %>
        </div>
      <% end %>
      
      <div class="search-box">
        <%= form_with url: listings_path, method: :get, local: true, class: "search-form" do |f| %>
          <div class="search-input-group">
            <%= f.text_field :search, placeholder: "What are you looking for?", class: "search-input" %>
            <%= f.text_field :location, placeholder: "Location (e.g., Dublin)", class: "search-input location-input" %>
            <%= f.submit "Search", class: "search-button" %>
          </div>
        <% end %>
      </div>
    </div>
  </section>
  <% end %>

  <!-- Categories Section (only show on homepage, not on filtered listings page) -->
  <% unless params[:category_id].present? || params[:search].present? %>
  <section class="categories-section">
    <div class="container">
      <h2 class="section-title">Browse by Category</h2>
      <div class="categories-grid">
        <% if @categories && @categories.any? %>
          <% @categories.each do |category| %>
            <%= link_to "/listings?category_id=#{category.id}", class: "category-card", data: { turbo: false } do %>
              <div class="category-icon"><%= category.icon || "ğŸ“¦" %></div>
              <h3><%= category.name %></h3>
              <p><%= category.description || "Browse #{category.name} listings" %></p>
            <% end %>
          <% end %>
        <% else %>
          <!-- Fallback categories if none in database - link by category name -->
          <%= link_to listings_path(search: "Motors"), class: "category-card" do %>
            <div class="category-icon">ğŸš—</div>
            <h3>Motors</h3>
            <p>Cars, Vans, Motorcycles</p>
          <% end %>
          <%= link_to listings_path(search: "Property"), class: "category-card" do %>
            <div class="category-icon">ğŸ </div>
            <h3>Property</h3>
            <p>Houses, Apartments, Land</p>
          <% end %>
          <%= link_to listings_path(search: "Jobs"), class: "category-card" do %>
            <div class="category-icon">ğŸ’¼</div>
            <h3>Jobs</h3>
            <p>Full-time, Part-time, Contract</p>
          <% end %>
          <%= link_to listings_path(search: "Electronics"), class: "category-card" do %>
            <div class="category-icon">ğŸ“±</div>
            <h3>Electronics</h3>
            <p>Phones, Computers, TVs</p>
          <% end %>
          <%= link_to listings_path(search: "Furniture"), class: "category-card" do %>
            <div class="category-icon">ğŸª‘</div>
            <h3>Furniture</h3>
            <p>Home & Garden</p>
          <% end %>
          <%= link_to listings_path(search: "Fashion"), class: "category-card" do %>
            <div class="category-icon">ğŸ‘•</div>
            <h3>Fashion</h3>
            <p>Clothing & Accessories</p>
          <% end %>
          <%= link_to listings_path(search: "Hobbies"), class: "category-card" do %>
            <div class="category-icon">ğŸ®</div>
            <h3>Hobbies</h3>
            <p>Sports, Games, Books</p>
          <% end %>
          <%= link_to listings_path(search: "Pets"), class: "category-card" do %>
            <div class="category-icon">ğŸ¾</div>
            <h3>Pets</h3>
            <p>Dogs, Cats, Birds</p>
          <% end %>
          <%= link_to listings_path(search: "Services"), class: "category-card" do %>
            <div class="category-icon">ğŸ”§</div>
            <h3>Services</h3>
            <p>Babysitting, Car Valeting, Cleaning</p>
          <% end %>
        <% end %>
      </div>
    </div>
  </section>
  <% end %>

  <!-- Featured Listings Section -->
  <section class="listings-section">
    <div class="container">
      <div class="section-header">
        <% if @selected_category %>
          <h2 class="section-title"><%= @selected_category.name %> Listings</h2>
        <% elsif params[:category_id].present? || params[:search].present? %>
          <h2 class="section-title">Search Results</h2>
        <% else %>
          <h2 class="section-title">Latest Ads</h2>
        <% end %>
        <%= link_to "View All", listings_path, class: "view-all-link" %>
      </div>
      
      <% if @listings.any? %>
        <% if @selected_category || params[:category_id].present? || params[:search].present? %>
          <p class="filter-info" style="margin-bottom: 1.5rem; color: #666; font-size: 0.9375rem;">
            Showing <%= @listings.count %> <%= @listings.count == 1 ? 'listing' : 'listings' %>
            <% if @selected_category %>
              in <%= @selected_category.name %>
            <% end %>
          </p>
        <% end %>
        <div class="listings-grid">
          <% (@selected_category || params[:category_id].present? || params[:search].present? ? @listings : @listings.limit(12)).each do |listing| %>
            <div class="listing-card">
              <div class="listing-image">
                <% if listing.images.attached? %>
                  <%= image_tag listing.images.first, class: "listing-card-image" %>
                <% else %>
                  <div class="image-placeholder">
                    <span>ğŸ“·</span>
                  </div>
                <% end %>
              </div>
              <div class="listing-content">
                <h3 class="listing-title">
                  <%= link_to listing.title, listing, class: "listing-link" %>
                </h3>
                <p class="listing-location">ğŸ“ <%= listing.city || "Location not specified" %></p>
                <p class="listing-description"><%= truncate(listing.description, length: 100) if listing.description %></p>
                <div class="listing-footer">
                  <span class="listing-price">
                    <% if listing.price %>
                      â‚¬<%= number_with_delimiter(listing.price.to_i) %>
                    <% else %>
                      Price on request
                    <% end %>
                  </span>
                  <%= link_to "View", listing, class: "btn-view" %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="empty-state">
          <p class="empty-message">No listings yet. Be the first to <%= link_to "post an ad", new_listing_path, class: "link" %>!</p>
        </div>
      <% end %>
    </div>
  </section>

  <!-- CTA Section (only show on homepage) -->
  <% unless params[:category_id].present? || params[:search].present? %>
  <section class="cta-section">
    <div class="container">
      <h2>Ready to sell something?</h2>
      <p>Post your ad for free - it only takes a minute!</p>
      <%= link_to "Post Your Ad Now", new_listing_path, class: "btn-cta" %>
    </div>
  </section>
  <% end %>
</div>
